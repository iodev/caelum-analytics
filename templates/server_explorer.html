<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caelum Server Explorer - Dynamic MCP Server Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .search-bar {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .search-input {
            width: 60%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .search-btn {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .server-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .server-card:hover {
            transform: translateY(-5px);
        }
        
        .server-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .server-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .workflow-server { background: #667eea; }
        .individual-server { background: #f39c12; }
        .core-server { background: #27ae60; }
        
        .server-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .server-type {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .server-description {
            color: #555;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        
        .server-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .capabilities {
            margin-bottom: 15px;
        }
        
        .capability-tag {
            display: inline-block;
            background: #ecf0f1;
            color: #2c3e50;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        .tools-section {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
        }
        
        .tools-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .tools-list {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .tool-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .tool-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        .tool-category {
            color: #7f8c8d;
            font-size: 0.8em;
        }
        
        .workflows-section {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .workflows-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .workflow-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }
        
        .workflow-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .workflow-description {
            color: #555;
            margin-bottom: 10px;
        }
        
        .workflow-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Caelum Server Explorer</h1>
            <div class="subtitle">Dynamic MCP Server Management & Tool Discovery</div>
        </div>
        
        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="Search capabilities, tools, or workflows...">
            <button class="search-btn" onclick="searchCapabilities()">üîç Search</button>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalServers">-</div>
                <div class="stat-label">Total Servers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTools">-</div>
                <div class="stat-label">Available Tools</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalWorkflows">-</div>
                <div class="stat-label">Workflows</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="externalLLMTools">-</div>
                <div class="stat-label">External LLM Compatible</div>
            </div>
        </div>
        
        <div id="searchResults" style="display: none;"></div>
        
        <div class="server-grid" id="serverGrid">
            <div class="loading">Loading server information...</div>
        </div>
        
        <div class="workflows-section" id="workflowsSection" style="display: none;">
            <h2>üìã Available Workflows</h2>
            <div id="workflowsList"></div>
        </div>
    </div>

    <script>
        let serverData = {};
        let workflowData = {};
        
        async function loadServerData() {
            try {
                // Load server hierarchy
                const response = await fetch('/api/servers/hierarchy?expand_tools=false');
                serverData = await response.json();
                
                // Load workflows
                const workflowResponse = await fetch('/api/servers/workflows');
                workflowData = await workflowResponse.json();
                
                // Load statistics
                const statsResponse = await fetch('/api/servers/statistics');
                const stats = await statsResponse.json();
                
                displayStatistics(stats);
                displayServers(serverData);
                displayWorkflows(workflowData);
                
            } catch (error) {
                document.getElementById('serverGrid').innerHTML = 
                    `<div class="error">Error loading server data: ${error.message}</div>`;
            }
        }
        
        function displayStatistics(stats) {
            document.getElementById('totalServers').textContent = stats.server_statistics.total_servers;
            document.getElementById('totalTools').textContent = stats.tool_statistics.total_tools;
            document.getElementById('totalWorkflows').textContent = stats.workflow_statistics.total_workflows;
            document.getElementById('externalLLMTools').textContent = stats.tool_statistics.external_llm_compatible_count;
        }
        
        function displayServers(data) {
            const serverGrid = document.getElementById('serverGrid');
            serverGrid.innerHTML = '';
            
            // Display workflow servers
            Object.entries(data.workflow_servers || {}).forEach(([name, server]) => {
                serverGrid.appendChild(createServerCard(name, server, 'workflow'));
            });
            
            // Display individual servers
            Object.entries(data.individual_servers || {}).forEach(([name, server]) => {
                serverGrid.appendChild(createServerCard(name, server, 'individual'));
            });
            
            // Display core servers
            Object.entries(data.core_servers || {}).forEach(([name, server]) => {
                serverGrid.appendChild(createServerCard(name, server, 'core'));
            });
        }
        
        function createServerCard(name, server, type) {
            const card = document.createElement('div');
            card.className = 'server-card';
            
            const iconEmojis = {
                'workflow': 'üîÑ',
                'individual': '‚öôÔ∏è',
                'core': 'üîß'
            };
            
            card.innerHTML = `
                <div class="server-header">
                    <div class="server-icon ${type}-server">${iconEmojis[type]}</div>
                    <div>
                        <div class="server-title">${name}</div>
                        <div class="server-type">${type} server</div>
                    </div>
                </div>
                <div class="server-description">${server.description}</div>
                <div class="server-stats">
                    <span>üîß ${server.tool_count} tools</span>
                    <span>üìä ${server.workflows?.length || 0} workflows</span>
                    <span>üîó ${server.underlying_services?.length || 0} services</span>
                </div>
                <div class="capabilities">
                    ${server.capabilities.map(cap => 
                        `<span class="capability-tag">${cap}</span>`
                    ).join('')}
                </div>
                <div class="tools-section">
                    <button class="tools-toggle" onclick="toggleTools('${name}')">
                        üõ†Ô∏è View Tools
                    </button>
                    <div class="tools-list" id="tools-${name}">
                        <div class="loading">Loading tools...</div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        async function toggleTools(serverName) {
            const toolsList = document.getElementById(`tools-${serverName}`);
            
            if (toolsList.style.display === 'none' || !toolsList.style.display) {
                toolsList.style.display = 'grid';
                
                // Load tools if not already loaded
                if (toolsList.querySelector('.loading')) {
                    try {
                        const response = await fetch(`/api/servers/servers/${serverName}?include_tools=true`);
                        const serverDetails = await response.json();
                        
                        toolsList.innerHTML = serverDetails.tools.map(tool => `
                            <div class="tool-item">
                                <div class="tool-name">${tool.name}</div>
                                <div class="tool-category">${tool.category}</div>
                            </div>
                        `).join('');
                    } catch (error) {
                        toolsList.innerHTML = `<div class="error">Error loading tools</div>`;
                    }
                }
            } else {
                toolsList.style.display = 'none';
            }
        }
        
        function displayWorkflows(data) {
            const workflowsSection = document.getElementById('workflowsSection');
            const workflowsList = document.getElementById('workflowsList');
            
            if (data.workflows && data.workflows.length > 0) {
                workflowsSection.style.display = 'block';
                
                workflowsList.innerHTML = data.workflows.map(workflow => `
                    <div class="workflow-card">
                        <div class="workflow-name">${workflow.name}</div>
                        <div class="workflow-description">${workflow.description}</div>
                        <div class="workflow-meta">
                            <span>üîß ${workflow.tools_count} tools</span>
                            <span>üè¢ ${workflow.servers_count} servers</span>
                            <span>üìä ${workflow.complexity} complexity</span>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        async function searchCapabilities() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            try {
                const response = await fetch(`/api/servers/search?capability=${encodeURIComponent(query)}`);
                const results = await response.json();
                
                displaySearchResults(results, query);
            } catch (error) {
                console.error('Search error:', error);
            }
        }
        
        function displaySearchResults(results, query) {
            const searchResults = document.getElementById('searchResults');
            const serverGrid = document.getElementById('serverGrid');
            
            searchResults.style.display = 'block';
            serverGrid.style.display = 'none';
            
            searchResults.innerHTML = `
                <div style="background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px;">
                    <h2>Search Results for "${query}"</h2>
                    
                    ${results.servers.length > 0 ? `
                        <h3>üì° Servers (${results.servers.length})</h3>
                        ${results.servers.map(server => `
                            <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <strong>${server.name}</strong><br>
                                ${server.description}<br>
                                <small>Matching: ${server.matching_capabilities.join(', ')}</small>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    ${results.tools.length > 0 ? `
                        <h3>üõ†Ô∏è Tools (${results.tools.length})</h3>
                        ${results.tools.map(tool => `
                            <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <strong>${tool.name}</strong> (${tool.server})<br>
                                ${tool.description}<br>
                                <small>Category: ${tool.category}</small>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    ${results.workflows.length > 0 ? `
                        <h3>üìã Workflows (${results.workflows.length})</h3>
                        ${results.workflows.map(workflow => `
                            <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <strong>${workflow.name}</strong><br>
                                ${workflow.description}<br>
                                <small>Use cases: ${workflow.matching_use_cases.join(', ')}</small>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    <button onclick="clearSearch()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin-top: 15px;">
                        ‚Üê Back to All Servers
                    </button>
                </div>
            `;
        }
        
        function clearSearch() {
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('serverGrid').style.display = 'grid';
            document.getElementById('searchInput').value = '';
        }
        
        // Handle search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchCapabilities();
            }
        });
        
        // Load data on page load
        loadServerData();
    </script>
</body>
</html>